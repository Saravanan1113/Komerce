{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Downloads\\\\Komerce-Ecomerce-main\\\\komerce-react\\\\src\\\\components\\\\user\\\\cart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport AuthContext from '../../context/authContext';\nimport * as ROUTES from '../../constants/routes';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Cart() {\n  _s();\n\n  const history = useNavigate();\n  const authCtx = useContext(AuthContext);\n  const isAuth = authCtx.isAuth;\n  console.log(authCtx.cartId);\n  const [cartData, setCartData] = useState([]); // const isValid = cartData.discount === '' || cartData.discounted_amount === '';\n\n  const isInvalid = cartData.total_item === 0 || authCtx.cartId === '';\n  console.log(isInvalid, cartData.total_item, authCtx.cartId); // const [cartId, setCartId] = useState(null);\n\n  console.log(authCtx.cartId);\n  const [quantityValue, setQuantityValue] = useState([]);\n  const [quantity, setQuantity] = useState('');\n  const [discountEntered, setDiscountEntered] = useState('');\n  const [error, setError] = useState('');\n  const [discounts, setDiscounts] = useState([]);\n  const [amountIsValid, setAmountIsValid] = useState(true);\n  const [existingCartItems, setExistingCartItems] = useState([]);\n  const [productData, setProductData] = useState([]);\n\n  const fetchProductData = async () => {\n    const result = await fetch(`http://localhost:3000/products`);\n    const data = await result.json();\n    setProductData(data.data.products); // const cart = data.data.user.cart_id\n    // setCartId(cart)\n  };\n\n  const fetchCartData = async () => {\n    console.log(\"entered\");\n    const result = await fetch(`http://localhost:3000/carts/${authCtx.cartId}`);\n    const data = await result.json();\n    console.log(data);\n    const newData = data.data.cart;\n    const eData = newData.existingItem;\n    setCartData(newData);\n    setExistingCartItems(eData);\n  };\n\n  console.log(cartData);\n\n  const fetchDiscountData = async () => {\n    const result = await fetch('http://localhost:3000/discounts');\n    const data = await result.json();\n    setDiscounts(data.data.discounts);\n  };\n\n  useEffect(() => {\n    document.title = \"Cart\"; // fetchUserData()\n\n    fetchCartData();\n    fetchDiscountData();\n    fetchProductData(); // fetchCartData()\n  }, []);\n\n  const checkInventor = async productId => {\n    const result = await fetch(`http://localhost:3000/products/${productId}`);\n    const data = await result.json();\n    return parseInt(data.data.product.inventory);\n  }; // useEffect(()=>{\n  //     if(cartData.total_item === 0){\n  //         alert(\"Your cart is empty, Please add product!\")\n  //     }\n  // })\n  // const inputHandler = (e, id) => {\n  //     e.preventDefault()\n  //     console.log(e.target.value,id)\n  //     setQuantity('')\n  //     quantityValue = parseInt(quantity)+parseInt(e.target.value)\n  //     existingCartItems.map((list, index) => {\n  //         if(index === id){\n  //             setQuantity(quantityValue)\n  //         }\n  //     })\n  // }\n\n\n  const inputHandler = (value, id) => {\n    console.log(value, id);\n    setQuantity(value);\n    existingCartItems.map(item => {\n      if (item.product_id === id) {\n        // item.quantity = value\n        // setCartData({...existingCartItems, quantity:value})\n        if (value !== '' && value.toString() !== '0') {\n          const obj = {\n            'id': id,\n            'quantity': value\n          };\n          quantityValue.push(obj);\n        } // setQuantityValue({\n        //     quantityValue: [...quantityValue, obj]\n        // })\n        // setQuantityValue(prevState => ({\n        //     quantityValue: [...prevState.quantityValue, {id:id, quantity:value}]\n        // }))\n\n      }\n    }); // e.target.value = \n    // setCartData({...existingItem, quantity:})\n  }; // console.log(quantityValue)\n\n\n  const overallUpdateHandler = async event => {\n    quantityValue.forEach(values => {\n      existingCartItems.map(item => {\n        if (values.id === item.product_id) {\n          updateQuantityHandler(event, item);\n        }\n      });\n    });\n  };\n\n  const updateQuantityHandler = async (event, cartItem) => {\n    event.preventDefault();\n    console.log(quantity);\n    const enteredQuantity = quantity;\n    console.log(enteredQuantity.trim.length);\n    const enteredAmountQuantity = +enteredQuantity;\n\n    if (enteredQuantity.includes('.')) {\n      toast.error(\"Quantity is not valid\", {\n        position: toast.POSITION.TOP_CENTER\n      });\n    } else if (enteredQuantity.trim().length === 0 || enteredAmountQuantity < 1) {\n      // setError(\"Please add product!\")\n      toast.warn(\"Add mininum 1 quantity\", {\n        position: toast.POSITION.TOP_CENTER\n      }); // setAmountIsValid(true)\n    } else if (enteredAmountQuantity > 5) {\n      toast.warn(\"Maximum Quantity is ()\", {\n        position: toast.POSITION.TOP_CENTER\n      }); // setAmountIsValid(false)\n      // setError('')\n      // return;\n    } else {\n      await fetch(`http://localhost:3000/carts/${authCtx.cartId}`, {\n        method: 'PATCH',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          product_id: cartItem.product_id,\n          product_name: cartItem.product_name,\n          product_price: cartItem.product_price,\n          product_image: cartItem.product_image,\n          quantity: quantity\n        })\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        } else {\n          return res.json().then(data => {\n            throw new Error(data.status);\n          });\n        }\n      }).then(data => {\n        fetchCartData(); // alert('Product updated successfully!')\n\n        setQuantity('');\n      }).catch(err => {\n        console.log(err.message);\n      });\n    }\n  };\n\n  const applyDiscountHandler = async event => {\n    event.preventDefault();\n    let discountedPrice = 0;\n    let discountIndex;\n    let discountCode;\n    const discountList = discounts.map(discount => discount.discount_code);\n\n    if (cartData.discount_code !== \"\") {\n      toast.error(\"Coupon already applied\", {\n        position: toast.POSITION.TOP_CENTER\n      });\n      setDiscountEntered('');\n    } else {\n      if (discountList.includes(discountEntered)) {\n        // setError('')\n        discountIndex = discounts.findIndex(discount => discount.discount_code === discountEntered);\n        discountCode = discounts[discountIndex];\n\n        if (discountCode.status === 'Active') {\n          // const discountInfo = discountCode\n          // if(discountCode){\n          //     // setError('')\n          setCartData({ ...cartData,\n            discount: discountEntered\n          });\n\n          if (discountCode.applied_all === 'all') {\n            existingCartItems.map(item => {\n              // console.log(cartData.total_amount)\n              const discountValue = Math.abs(discountCode.discount_value / 100 * 100).toFixed(2);\n              let totalDiscount = parseFloat(item.product_price * discountValue / 100);\n              const discountedAmount = parseFloat(item.product_price - totalDiscount);\n              discountedPrice = parseFloat(discountedPrice + totalDiscount * item.quantity); // const discountAmount = \n              // const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n              // discountedPrice = parseFloat(discountedPrice)+parseFloat(finalPrice)\n              // const discountedAmount = parseFloat(parseInt(item.product_price)*parseInt(item.quantity))-parseFloat(discountedPrice)\n\n              console.log(discountValue, totalDiscount, discountedAmount, discountedPrice);\n            });\n          } else {\n            discountCode.products.map(product => {\n              existingCartItems.map(item => {\n                // console.log(item)\n                // console.log(item.product_id, product)\n                if (item.product_id === product) {\n                  const discountValue = Math.abs(discountCode.discount_value / 100 * 100).toFixed(2);\n                  let totalDiscount = parseFloat(item.product_price * discountValue / 100);\n                  const discountedAmount = parseFloat(item.product_price - totalDiscount);\n                  discountedPrice = parseFloat(discountedPrice + totalDiscount * item.quantity); //     console.log(product)\n                  //     const discountValue=Math.abs((discountCode.discount_value/100)*100).toFixed(2)\n                  //     let totalDiscount=parseFloat(item.product_price-(item.product_price*discountValue/100))\n                  //     totalDiscount = totalDiscount\n                  //     const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n                  //     console.log(\"final\",finalPrice)\n                  //     discountedAmount = parseFloat(discountedAmount)+parseFloat(finalPrice)\n                  //     console.log(\"discount\",discountedAmount)\n\n                  console.log(discountValue, totalDiscount, discountedAmount, discountedPrice);\n                }\n              });\n            });\n          }\n        } else {\n          toast.error(\"Please fill valid coupon!\", {\n            position: toast.POSITION.TOP_CENTER\n          });\n          setDiscountEntered('');\n        }\n      } else {\n        toast.error(\"Please fill valid coupon!\", {\n          position: toast.POSITION.TOP_CENTER\n        });\n        setDiscountEntered(''); // setError(\"Please provide valid Coupon!\")\n      }\n\n      if (discountedPrice > 0) {\n        await fetch(`http://localhost:3000/carts/${authCtx.cartId}`, {\n          method: 'PATCH',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            type: \"discount\",\n            discount: discountEntered,\n            discount_value: discountCode.discount_value,\n            discounted_amount: discountedPrice\n          })\n        }).then(data => {\n          setDiscountEntered('');\n          fetchCartData();\n          toast.success(\"Coupon Applied!\", {\n            position: toast.POSITION.TOP_CENTER\n          });\n        });\n        const timeUsed = discountCode.time_used + 1; // console.log(discountCode.time_used,timeUsed)\n\n        await fetch(`http://localhost:3000/discounts/${discountCode._id}`, {\n          method: 'PATCH',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            time_used: timeUsed\n          })\n        });\n      } else {\n        toast.error(\"Coupon is not valid for these products!\", {\n          position: toast.POSITION.TOP_CENTER\n        });\n        setDiscountEntered('');\n      }\n    } // if(cartData.total_item === 0 || cartData.discount !==\"\"){\n    //     alert(\"Your cart is empty, Please add product!\")\n    // }else{\n    //     discountIndex = discounts.findIndex(\n    //         (discount) => discount.discount_code === discountEntered\n    //     );\n    //     discountCode = discounts[discountIndex] \n    //     console.log(discountCode)\n    // }\n    // if(discountCode){\n    //     // setError('')\n    //     setCartData({...cartData, discount: discountEntered})\n    //         if(discountCode.applied_all === 'all'){\n    //             console.log(\"For All products\")\n    //         }else{\n    //             discountCode.products.map(product => {\n    //                 existingCartItems.map(item => {\n    //                     // console.log(item)\n    //                     // console.log(item.product_id, product)\n    //                     if(item.product_id === product){\n    //                         console.log(product)\n    //                         const discountValue=Math.abs((discountCode.discount_value/100)*100).toFixed(2)\n    //                         let totalDiscount=parseFloat(item.product_price-(item.product_price*discountValue/100))\n    //                         totalDiscount = totalDiscount\n    //                         const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n    //                         console.log(\"final\",finalPrice)\n    //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(finalPrice)\n    //                         console.log(\"discount\",discountedAmount)\n    //                     }\n    //                     else{\n    //                         console.log(product)\n    //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(item.product_price)\n    //                         console.log(discountedAmount)\n    //                     }\n    //                 })\n    //             })\n    //         }  \n    // }else{\n    //     setError(\"Please enter valid Coupon!\");\n    //     setDiscountEntered('')\n    // }\n    // discounts.filter(discount => {\n    //     if(discount.discount_code.includes(discountEntered)){\n    //         setCartData({...cartData, discount: discountEntered})\n    //         if(discount.applied_all === 'all'){\n    //             console.log(\"For All products\")\n    //         }else{\n    //             discount.products.map(product => {\n    //                 console.log(product)\n    //                 existingCartItems.map(item => {\n    //                     if(item.product_id === product){\n    //                         const discountValue=Math.abs((discount.discount_value/100)*100).toFixed(2)\n    //                         let totalDiscount=parseFloat(item.product_price-(item.product_price*discountValue/100))\n    //                         totalDiscount = totalDiscount\n    //                         const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n    //                         // console.log(\"final\",finalPrice)\n    //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(finalPrice)\n    //                         console.log(\"discount\",discountedAmount)\n    //                     }else{\n    //                         // console.log(item.product_price)\n    //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(item.product_price)\n    //                     }\n    //                 })\n    //             })\n    //         }  \n    //     }else{\n    //         setError(\"Please enter valid Coupon!\");\n    //         setDiscountEntered('')\n    //     }\n    // })\n    // await fetch(`http://localhost:3000/carts/${authCtx.cartId}`,{\n    // \tmethod: 'PATCH',\n    // \theaders: {\n    // \t\t'Accept' : 'application/json',\n    // \t\t'Content-Type' : 'application/json',\n    // \t},\n    // \tbody: JSON.stringify({\n    // \t\tdiscount: discountEntered,\n    //         discounted_amount: discountedAmount\n    // \t})\n    // }).then(data=>{\n    //     fetchCartData()\n    // })\n\n  };\n\n  const deleteProductHandler = async (event, id) => {\n    console.log(id);\n    event.preventDefault();\n    await fetch(`http://localhost:3000/carts/${authCtx.cartId}`, {\n      method: 'DELETE',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        id: id\n      })\n    }).then(data => {\n      fetchCartData();\n    });\n  }; // console.log(cartData)\n\n\n  return isInvalid === true ? /*#__PURE__*/_jsxDEV(\"h3\", {\n    className: \"no-data\",\n    children: \"Your cart is Empty! Please add product.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 398,\n    columnNumber: 9\n  }, this) : /*#__PURE__*/_jsxDEV(\"section\", {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-template page-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-count-price\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"no-margin\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"cart-total-quantity\",\n              children: [\"TOTAL: \", cartData.total_quantity, \" items\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 26\n            }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n              className: \"cart-total-price\",\n              children: [\"(\", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  id: \"revy-cart-subtotal-price\",\n                  children: [\"$\", cartData.total_amount]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 408,\n                  columnNumber: 34\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 408,\n                columnNumber: 28\n              }, this), \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 407,\n              columnNumber: 26\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 22\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"main-cart-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cart__items cart__block\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"line-items\",\n              children: existingCartItems.map((cartItem, i) =>\n              /*#__PURE__*/\n              // parseInt(cartItem.inventory) > 0 ?\n              _jsxDEV(\"div\", {\n                className: \"line-item\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"line-item__left\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"line-item__image-wrapper\",\n                    children: /*#__PURE__*/_jsxDEV(\"img\", {\n                      className: \"line-item__image\",\n                      src: `images/product/${cartItem.product_image}`,\n                      alt: \"\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 421,\n                      columnNumber: 53\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 420,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 419,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"line-item__right\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"line-item__details\",\n                    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                      className: \"line-item-title\",\n                      children: /*#__PURE__*/_jsxDEV(Link, {\n                        to: ROUTES.PRODUCT.replace(\":id\", cartItem.product_id),\n                        className: \"cart__product-title\",\n                        children: cartItem.product_name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 427,\n                        columnNumber: 57\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 426,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                      onClick: e => deleteProductHandler(e, cartItem._id),\n                      title: \"Remove item\",\n                      className: \"line-item__remove\",\n                      children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                        \"aria-hidden\": \"true\",\n                        viewBox: \"0 0 448 512\",\n                        className: \"svg-inline--fa fa-trash-alt fa-w-14 fa-3x\",\n                        children: /*#__PURE__*/_jsxDEV(\"path\", {\n                          fill: \"currentColor\",\n                          d: \"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\",\n                          className: \"\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 433,\n                          columnNumber: 61\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 432,\n                        columnNumber: 57\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 431,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 425,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"line-item__price\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                        children: \"Price:\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 439,\n                        columnNumber: 59\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 439,\n                      columnNumber: 53\n                    }, this), \"$\", cartItem.product_price]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 438,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"line-item__total-amount-price\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                        children: \"Total Price:\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 443,\n                        columnNumber: 59\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 443,\n                      columnNumber: 53\n                    }, this), \"$\", cartItem.product_price * cartItem.quantity]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 442,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"line-item__quantity\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"line-item__quantity-text\",\n                      children: \"Quantity:\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 447,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"text\" // name=\"updates[]\" \n                      ,\n                      pattern: \"[0-9]*\",\n                      size: \"4\",\n                      input: {\n                        min: '1',\n                        max: cartItem.inventory\n                      },\n                      defaultValue: cartItem.quantity,\n                      onChange: e => {\n                        // inputHandler(e, i) \n                        if (!e.target.validity.valid) {\n                          toast.error(\"Quantity should be number!\", {\n                            position: toast.POSITION.TOP_CENTER\n                          });\n                        } else if (e.target.value === '' || e.target.value === 0) {\n                          toast.warn(`You can choose maximum (${cartItem.inventory}) only!`, {\n                            position: toast.POSITION.TOP_CENTER\n                          });\n                        } else {\n                          inputHandler(e.target.value, cartItem.product_id);\n                        }\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 448,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                      onClick: e => {\n                        updateQuantityHandler(e, cartItem);\n\n                        if (amountIsValid === true) {\n                          toast.success(\"Product updated successfully!\", {\n                            position: toast.POSITION.TOP_CENTER\n                          });\n                        } else {\n                          toast.error(`You can choose maximum (${cartItem.inventory}) only!`, {\n                            position: toast.POSITION.TOP_CENTER\n                          });\n                        }\n                      },\n                      className: \"button update_btn\",\n                      type: \"submit\",\n                      children: \"Update Quantity\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 470,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 446,\n                    columnNumber: 49\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 424,\n                  columnNumber: 45\n                }, this)]\n              }, cartItem._id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 41\n              }, this) // : null\n              )\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 414,\n              columnNumber: 20\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cart__details cart__block\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"cart__details-wrap\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                children: \"ORDER SUMMARY\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 490,\n                columnNumber: 24\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"no-margin evenly-align\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"cart-total-quantity\",\n                  children: [cartData.total_quantity, \" items\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 492,\n                  columnNumber: 28\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"cart-total-price\",\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: [\"$\", cartData.total_amount]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 494,\n                    columnNumber: 29\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 493,\n                  columnNumber: 28\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 491,\n                columnNumber: 24\n              }, this), cartData.discounted_amount !== 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-subtotal evenly-align cart__total\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"cart-subtotal__title\",\n                  children: \"Discount\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 499,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"cart-subtotal__price\",\n                    children: [\"-$\", cartData.discounted_amount]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 500,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 500,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 498,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-subtotal evenly-align cart__total\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"cart-subtotal__title\",\n                  children: \"Subtotal\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 504,\n                  columnNumber: 28\n                }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"cart-subtotal__price\",\n                    children: [\"$\", parseFloat(cartData.total_amount) - parseFloat(cartData.discounted_amount)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 505,\n                    columnNumber: 36\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 505,\n                  columnNumber: 28\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 503,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart__total evenly-align\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"cart__total-text\",\n                  children: \"Total:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 508,\n                  columnNumber: 28\n                }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n                  className: \"cart__total-price\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    children: [\"$\", parseFloat(cartData.total_amount) - parseFloat(cartData.discounted_amount)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 510,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \" USD\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 511,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 509,\n                  columnNumber: 28\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 507,\n                columnNumber: 24\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"button update_btn\",\n                type: \"submit\",\n                onClick: e => {\n                  overallUpdateHandler(e);\n                  toast.success(\"Product updated successfully!\", {\n                    position: toast.POSITION.TOP_CENTER\n                  });\n                },\n                children: \"Update Quantity\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 514,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(Link, {\n                to: cartData.total_item !== 0 ? ROUTES.CHECKOUT : ROUTES.COLLECTIONS,\n                className: \"button checkout_btn button--hollow\",\n                children: \"Checkout\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 519,\n                columnNumber: 24\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-promo\",\n                children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                  children: \"ENTER A PROMO CODE\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 521,\n                  columnNumber: 25\n                }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"error-message\",\n                  children: error\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 522,\n                  columnNumber: 47\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  id: \"devPromo\",\n                  value: discountEntered,\n                  onChange: _ref => {\n                    let {\n                      target\n                    } = _ref;\n                    return setDiscountEntered(target.value);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 523,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(Link, {\n                  to: ROUTES.CART,\n                  onClick: applyDiscountHandler,\n                  children: \"Apply Coupon\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 529,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 520,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-center mt-20\",\n                children: /*#__PURE__*/_jsxDEV(Link, {\n                  to: ROUTES.COLLECTIONS,\n                  title: \"Continue shopping\",\n                  children: \"Continue shopping\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 537,\n                  columnNumber: 24\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 536,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 489,\n              columnNumber: 20\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 18\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 400,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Cart, \"EgxZAthxAl7yDBOyXkgV/vK0TX8=\", false, function () {\n  return [useNavigate];\n});\n\n_c = Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"sources":["C:/Users/Admin/Downloads/Komerce-Ecomerce-main/komerce-react/src/components/user/cart.js"],"names":["React","useState","useEffect","useContext","Link","useNavigate","toast","AuthContext","ROUTES","Cart","history","authCtx","isAuth","console","log","cartId","cartData","setCartData","isInvalid","total_item","quantityValue","setQuantityValue","quantity","setQuantity","discountEntered","setDiscountEntered","error","setError","discounts","setDiscounts","amountIsValid","setAmountIsValid","existingCartItems","setExistingCartItems","productData","setProductData","fetchProductData","result","fetch","data","json","products","fetchCartData","newData","cart","eData","existingItem","fetchDiscountData","document","title","checkInventor","productId","parseInt","product","inventory","inputHandler","value","id","map","item","product_id","toString","obj","push","overallUpdateHandler","event","forEach","values","updateQuantityHandler","cartItem","preventDefault","enteredQuantity","trim","length","enteredAmountQuantity","includes","position","POSITION","TOP_CENTER","warn","method","headers","body","JSON","stringify","product_name","product_price","product_image","then","res","ok","Error","status","catch","err","message","applyDiscountHandler","discountedPrice","discountIndex","discountCode","discountList","discount","discount_code","findIndex","applied_all","discountValue","Math","abs","discount_value","toFixed","totalDiscount","parseFloat","discountedAmount","type","discounted_amount","success","timeUsed","time_used","_id","deleteProductHandler","total_quantity","total_amount","i","PRODUCT","replace","e","min","max","target","validity","valid","CHECKOUT","COLLECTIONS","CART"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useContext} from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\n\nimport AuthContext from '../../context/authContext';\nimport * as ROUTES from '../../constants/routes';\n\nexport default function Cart(){\n    const history = useNavigate()\n    const authCtx = useContext(AuthContext);\n    const isAuth = authCtx.isAuth;\n    console.log(authCtx.cartId)\n    const [cartData, setCartData] = useState([]);\n    // const isValid = cartData.discount === '' || cartData.discounted_amount === '';\n    const isInvalid = cartData.total_item === 0 || authCtx.cartId === ''\n    console.log(isInvalid, cartData.total_item, authCtx.cartId)\n    // const [cartId, setCartId] = useState(null);\n    console.log(authCtx.cartId)\n    const [quantityValue, setQuantityValue] = useState([])\n    const [quantity, setQuantity] = useState('');\n    const [discountEntered, setDiscountEntered] = useState('');\n    const [error, setError] = useState('')\n    const [discounts, setDiscounts] = useState([]);\n    const [amountIsValid, setAmountIsValid] = useState(true);\n    const [existingCartItems, setExistingCartItems] = useState([])\n    const [productData, setProductData] = useState([]);\n\n    const fetchProductData = async () => {\n\t\tconst result = await fetch(`http://localhost:3000/products`)\n\t\tconst data = await result.json()\n        setProductData(data.data.products)\n\t\t// const cart = data.data.user.cart_id\n        // setCartId(cart)\n\t}\n\n    const fetchCartData = async () => {\n        console.log(\"entered\")\n\t\tconst result = await fetch(`http://localhost:3000/carts/${authCtx.cartId}`)\n\t\tconst data = await result.json()\n        console.log(data)\n        const newData = data.data.cart\n        const eData = newData.existingItem\n\t\tsetCartData(newData)\n        setExistingCartItems(eData)\n\t}\n    console.log(cartData)\n\n    const fetchDiscountData = async () => {\n        const result = await fetch('http://localhost:3000/discounts')\n\t\tconst data = await result.json()\n\t\tsetDiscounts(data.data.discounts)\n    }\n\n\tuseEffect(() => {\n        document.title = \"Cart\"\n        // fetchUserData()\n        fetchCartData()\n        fetchDiscountData()\n        fetchProductData()\n        // fetchCartData()\n\t},[])\n\n    const checkInventor = async(productId) =>{\n        const result = await fetch(`http://localhost:3000/products/${productId}`)\n\t\tconst data = await result.json()\n        return(parseInt(data.data.product.inventory))\n    }\n\n    // useEffect(()=>{\n    //     if(cartData.total_item === 0){\n    //         alert(\"Your cart is empty, Please add product!\")\n    //     }\n    // })\n\n\n    // const inputHandler = (e, id) => {\n    //     e.preventDefault()\n    //     console.log(e.target.value,id)\n    //     setQuantity('')\n    //     quantityValue = parseInt(quantity)+parseInt(e.target.value)\n    //     existingCartItems.map((list, index) => {\n    //         if(index === id){\n    //             setQuantity(quantityValue)\n    //         }\n    //     })\n\n    // }\n    const inputHandler = (value, id) => {\n        console.log(value, id)\n        setQuantity(value)\n\n        existingCartItems.map((item) => {\n            if(item.product_id === id){\n                // item.quantity = value\n                // setCartData({...existingCartItems, quantity:value})\n                if(value !== '' && value.toString() !== '0'){\n                    const obj = {'id':id, 'quantity':value}\n                    quantityValue.push(obj)\n                }\n                \n                // setQuantityValue({\n                //     quantityValue: [...quantityValue, obj]\n                // })\n                // setQuantityValue(prevState => ({\n                //     quantityValue: [...prevState.quantityValue, {id:id, quantity:value}]\n                // }))\n            }\n        })\n        // e.target.value = \n        // setCartData({...existingItem, quantity:})\n    }\n    // console.log(quantityValue)\n\n    const overallUpdateHandler = async(event) => {\n        quantityValue.forEach(values => {\n            existingCartItems.map((item) => {\n                if(values.id===item.product_id){\n                    updateQuantityHandler(event,item)\n                }\n            })\n        })\n    }\n\n    const updateQuantityHandler = async(event, cartItem) => {\n        event.preventDefault()\n        console.log(quantity)\n        const enteredQuantity = quantity;\n        console.log(enteredQuantity.trim.length)\n\t\tconst enteredAmountQuantity = +enteredQuantity;\n\n\t\tif(enteredQuantity.includes('.')){\n\t\t\ttoast.error(\"Quantity is not valid\", {position: toast.POSITION.TOP_CENTER})\n\t\t}\n\t\telse if(enteredQuantity.trim().length === 0 || enteredAmountQuantity < 1)\n\t\t{\n\t\t\t// setError(\"Please add product!\")\n\t\t\ttoast.warn(\"Add mininum 1 quantity\", {position: toast.POSITION.TOP_CENTER})\n\t\t\t// setAmountIsValid(true)\n\t\t}\n\n\t\telse if(enteredAmountQuantity > 5){\n\t\t\ttoast.warn(\"Maximum Quantity is ()\", {position: toast.POSITION.TOP_CENTER})\n\t\t\t// setAmountIsValid(false)\n\t\t\t// setError('')\n\t\t\t// return;\n\t\t}\n\n\t\telse{\n\n            await fetch(`http://localhost:3000/carts/${authCtx.cartId}`,{\n                method: 'PATCH',\n                headers: {\n                    'Accept' : 'application/json',\n                    'Content-Type' : 'application/json',\n                },\n                body: JSON.stringify({\n                    product_id: cartItem.product_id,\n                    product_name: cartItem.product_name,\n                    product_price: cartItem.product_price,\n                    product_image: cartItem.product_image,\n                    quantity: quantity,\n                })\n            }).then(res => {\n                if(res.ok){\n                    return res.json();\n                }else{\n                    return res.json().then((data) => {\n                        throw new Error(data.status);\n                    });\n                }\n            }).then(data => {\n                fetchCartData()\n                // alert('Product updated successfully!')\n                setQuantity('')\n            }).catch((err) => {\n                console.log(err.message)\n            })\n        }\n    }\n\n    const applyDiscountHandler = async(event) => {\n        event.preventDefault()\n        let discountedPrice = 0;\n        let discountIndex;\n        let discountCode;\n\n        const discountList = discounts.map(discount => discount.discount_code)\n        if(cartData.discount_code !==\"\"){\n            toast.error(\"Coupon already applied\", {position: toast.POSITION.TOP_CENTER})\n            setDiscountEntered('')\n        }else{\n            if(discountList.includes(discountEntered)){\n                // setError('')\n                discountIndex = discounts.findIndex(\n                    (discount) => discount.discount_code === discountEntered\n                );\n                discountCode = discounts[discountIndex]\n                if(discountCode.status === 'Active'){\n                    // const discountInfo = discountCode\n                    // if(discountCode){\n                    //     // setError('')\n                        setCartData({...cartData, discount: discountEntered})\n                            if(discountCode.applied_all === 'all'){\n                                existingCartItems.map(item => {\n                                    // console.log(cartData.total_amount)\n                                    const discountValue=Math.abs((discountCode.discount_value/100)*100).toFixed(2)\n                                    let totalDiscount=parseFloat(item.product_price*discountValue/100)\n                                    const discountedAmount = parseFloat(item.product_price-totalDiscount)\n                                    discountedPrice = parseFloat(discountedPrice+totalDiscount*item.quantity)\n                                    // const discountAmount = \n                                    // const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n                                    // discountedPrice = parseFloat(discountedPrice)+parseFloat(finalPrice)\n                                    // const discountedAmount = parseFloat(parseInt(item.product_price)*parseInt(item.quantity))-parseFloat(discountedPrice)\n                                    console.log(discountValue, totalDiscount, discountedAmount, discountedPrice)\n                                })\n                            }\n                            else{\n                                discountCode.products.map(product => {\n                                    existingCartItems.map(item => {\n                                        // console.log(item)\n                                        // console.log(item.product_id, product)\n                                        if(item.product_id === product){\n                                            const discountValue=Math.abs((discountCode.discount_value/100)*100).toFixed(2)\n                                            let totalDiscount=parseFloat(item.product_price*discountValue/100)\n                                            const discountedAmount = parseFloat(item.product_price-totalDiscount)\n                                            discountedPrice = parseFloat(discountedPrice+totalDiscount*item.quantity)\n                                        //     console.log(product)\n                                        //     const discountValue=Math.abs((discountCode.discount_value/100)*100).toFixed(2)\n                                        //     let totalDiscount=parseFloat(item.product_price-(item.product_price*discountValue/100))\n                                        //     totalDiscount = totalDiscount\n                                        //     const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n                                        //     console.log(\"final\",finalPrice)\n                                        //     discountedAmount = parseFloat(discountedAmount)+parseFloat(finalPrice)\n                                        //     console.log(\"discount\",discountedAmount)\n                                            console.log(discountValue, totalDiscount, discountedAmount, discountedPrice)\n                                        }\n                                    })\n                                })\n                            }  \n                }else{\n                    toast.error(\"Please fill valid coupon!\", {position: toast.POSITION.TOP_CENTER})\n                    setDiscountEntered('')\n                }\n            \n            }else{\n                toast.error(\"Please fill valid coupon!\", {position: toast.POSITION.TOP_CENTER})\n                setDiscountEntered('')\n                // setError(\"Please provide valid Coupon!\")\n            }\n            if(discountedPrice>0){\n                await fetch(`http://localhost:3000/carts/${authCtx.cartId}`,{\n                                method: 'PATCH',\n                                headers: {\n                                    'Accept' : 'application/json',\n                                    'Content-Type' : 'application/json',\n                                },\n                                body: JSON.stringify({\n                                    type: \"discount\",\n                                    discount: discountEntered,\n                                    discount_value: discountCode.discount_value,\n                                    discounted_amount: discountedPrice\n                                })\n                            }).then(data=>{\n                                setDiscountEntered('')\n                                fetchCartData()\n                                toast.success(\"Coupon Applied!\", {position: toast.POSITION.TOP_CENTER})\n                            })\n                const timeUsed = discountCode.time_used+1\n                // console.log(discountCode.time_used,timeUsed)\n                await fetch(`http://localhost:3000/discounts/${discountCode._id}`,{\n                    method: 'PATCH',\n                    headers: {\n                        'Accept' : 'application/json',\n                        'Content-Type' : 'application/json',\n                    },\n                    body: JSON.stringify({\n                        time_used: timeUsed\n                    })\n                })\n            }else{\n\n                toast.error(\"Coupon is not valid for these products!\", {position: toast.POSITION.TOP_CENTER})\n                setDiscountEntered('')\n            }\n            \n        }\n        \n        // if(cartData.total_item === 0 || cartData.discount !==\"\"){\n        //     alert(\"Your cart is empty, Please add product!\")\n        // }else{\n        //     discountIndex = discounts.findIndex(\n        //         (discount) => discount.discount_code === discountEntered\n        //     );\n            \n        //     discountCode = discounts[discountIndex] \n        //     console.log(discountCode)\n        // }\n\n        // if(discountCode){\n        //     // setError('')\n        //     setCartData({...cartData, discount: discountEntered})\n        //         if(discountCode.applied_all === 'all'){\n        //             console.log(\"For All products\")\n        //         }else{\n        //             discountCode.products.map(product => {\n        //                 existingCartItems.map(item => {\n        //                     // console.log(item)\n        //                     // console.log(item.product_id, product)\n        //                     if(item.product_id === product){\n        //                         console.log(product)\n        //                         const discountValue=Math.abs((discountCode.discount_value/100)*100).toFixed(2)\n        //                         let totalDiscount=parseFloat(item.product_price-(item.product_price*discountValue/100))\n        //                         totalDiscount = totalDiscount\n        //                         const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n        //                         console.log(\"final\",finalPrice)\n        //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(finalPrice)\n        //                         console.log(\"discount\",discountedAmount)\n        //                     }\n        //                     else{\n        //                         console.log(product)\n        //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(item.product_price)\n        //                         console.log(discountedAmount)\n        //                     }\n        //                 })\n        //             })\n        //         }  \n        // }else{\n        //     setError(\"Please enter valid Coupon!\");\n        //     setDiscountEntered('')\n        // }\n        // discounts.filter(discount => {\n        //     if(discount.discount_code.includes(discountEntered)){\n        //         setCartData({...cartData, discount: discountEntered})\n        //         if(discount.applied_all === 'all'){\n        //             console.log(\"For All products\")\n        //         }else{\n        //             discount.products.map(product => {\n        //                 console.log(product)\n        //                 existingCartItems.map(item => {\n        //                     if(item.product_id === product){\n        //                         const discountValue=Math.abs((discount.discount_value/100)*100).toFixed(2)\n        //                         let totalDiscount=parseFloat(item.product_price-(item.product_price*discountValue/100))\n        //                         totalDiscount = totalDiscount\n        //                         const finalPrice = (totalDiscount*item.quantity).toFixed(2)\n        //                         // console.log(\"final\",finalPrice)\n        //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(finalPrice)\n        //                         console.log(\"discount\",discountedAmount)\n        //                     }else{\n        //                         // console.log(item.product_price)\n        //                         discountedAmount = parseFloat(discountedAmount)+parseFloat(item.product_price)\n        //                     }\n        //                 })\n        //             })\n        //         }  \n        //     }else{\n        //         setError(\"Please enter valid Coupon!\");\n        //         setDiscountEntered('')\n        //     }\n        // })\n        \n        // await fetch(`http://localhost:3000/carts/${authCtx.cartId}`,{\n\t\t// \tmethod: 'PATCH',\n\t\t// \theaders: {\n\t\t// \t\t'Accept' : 'application/json',\n\t\t// \t\t'Content-Type' : 'application/json',\n\t\t// \t},\n\t\t// \tbody: JSON.stringify({\n\t\t// \t\tdiscount: discountEntered,\n        //         discounted_amount: discountedAmount\n\t\t// \t})\n\t\t// }).then(data=>{\n        //     fetchCartData()\n        // })\n    }\n\n\n    const deleteProductHandler = async(event, id) => {\n        console.log(id)\n        event.preventDefault();\n        await fetch(`http://localhost:3000/carts/${authCtx.cartId}`,{\n\t\t\tmethod: 'DELETE',\n\t\t\theaders: {\n\t\t\t\t'Accept' : 'application/json',\n\t\t\t\t'Content-Type' : 'application/json',\n\t\t\t},\n            body: JSON.stringify({\n\t\t\t\tid: id\n\t\t\t})\n\t\t}).then(data=>{\n            fetchCartData()\n        })\n    }\n\n    // console.log(cartData)\n    return(\n        isInvalid === true ?\n        <h3 className=\"no-data\">Your cart is Empty! Please add product.</h3>\n        :\n        <section>\n\t\t\t<div className=\"container\">\n\t\t\t\t<div className=\"cart-template page-content\">\n\t\t\t\t\t<h2>Cart</h2>\n\t\t\t\t\t<div className=\"cart-count-price\">\n\t                    <p className=\"no-margin\">\n\t                        <span className=\"cart-total-quantity\">TOTAL: {cartData.total_quantity} items</span>\n\t                        <strong className=\"cart-total-price\">\n\t                        \t(<span><span id=\"revy-cart-subtotal-price\">${cartData.total_amount}</span></span>)\n\t                        </strong>\n\t                    </p>\n\t                </div>\n\t                <div className=\"main-cart-wrapper\">\n\t\t                <div className=\"cart__items cart__block\">\n\t\t\t                <div className=\"line-items\">\n                                {\n                                    existingCartItems.map((cartItem, i) => (\n                                        // parseInt(cartItem.inventory) > 0 ?\n                                        <div className=\"line-item\" key={cartItem._id}>\n                                            <div className=\"line-item__left\">\n                                                <div className=\"line-item__image-wrapper\">\n                                                    <img className=\"line-item__image\" src={`images/product/${cartItem.product_image}`} alt=\"\"/>\n                                                </div>\n                                            </div>\t\n                                            <div className=\"line-item__right\">\n                                                <div className=\"line-item__details\">\n                                                    <h2 className=\"line-item-title\">\n                                                        <Link to={ROUTES.PRODUCT.replace(\":id\",cartItem.product_id)} className=\"cart__product-title\">\n                                                            {cartItem.product_name}\n                                                        </Link>\n                                                    </h2>\n                                                    <a onClick={(e) => deleteProductHandler(e,cartItem._id)} title=\"Remove item\" className=\"line-item__remove\">\n                                                        <svg aria-hidden=\"true\" viewBox=\"0 0 448 512\" className=\"svg-inline--fa fa-trash-alt fa-w-14 fa-3x\">\n                                                            <path fill=\"currentColor\" d=\"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\" className=\"\"></path>\n                                                        </svg>\n                                                    </a>\n                                                </div>\n                                                \n                                                <div className=\"line-item__price\">\n                                                    <span><strong>Price:</strong></span>${cartItem.product_price}\n                                                </div>\n                                            \n                                                <div className=\"line-item__total-amount-price\">\n                                                    <span><strong>Total Price:</strong></span>${cartItem.product_price*cartItem.quantity}\n                                                </div>\n                                            \n                                                <div className=\"line-item__quantity\">\n                                                    <span className=\"line-item__quantity-text\">Quantity:</span>\n                                                    <input \n                                                        type=\"text\" \n                                                        // name=\"updates[]\" \n                                                        pattern=\"[0-9]*\"\n                                                        size=\"4\" \n                                                        input={{\n                                                            min:'1',\n                                                            max: cartItem.inventory,\n                                                        }}\n                                                        defaultValue={cartItem.quantity}\n                                                        onChange={(e) => {\n                                                            // inputHandler(e, i) \n                                                            if(!e.target.validity.valid){\n                                                                toast.error(\"Quantity should be number!\", {position: toast.POSITION.TOP_CENTER})\n                                                            }\n                                                            else if(e.target.value === '' || e.target.value ===0){\n                                                                toast.warn(`You can choose maximum (${cartItem.inventory}) only!`, {position: toast.POSITION.TOP_CENTER})\n                                                            }else{\n                                                                inputHandler(e.target.value, cartItem.product_id)\n                                                            }\n                                                        }}\n                                                    />\n                                                    <button onClick={(e)=> {\n                                                        updateQuantityHandler(e,cartItem)\n                                                        if(amountIsValid === true){\n                                                            toast.success(\"Product updated successfully!\", {position: toast.POSITION.TOP_CENTER})\n                                                        }else{\n                                                            toast.error(`You can choose maximum (${cartItem.inventory}) only!`, {position: toast.POSITION.TOP_CENTER})\n                                                        }\n                                                        }} \n                                                    className=\"button update_btn\" type=\"submit\">Update Quantity</button>\n                                                </div>\n                                                {/* {!amountIsValid && <p>You can choose maximum () only!</p>} */}\n                                            </div>\n                                        </div>\n                                        // : null\n                                    ))\n                                }\n\t\t\t                </div>\n\t\t                </div>\n\t\t                <div className=\"cart__details cart__block\">\n\t\t\t                <div className=\"cart__details-wrap\">\n\t\t\t                    <h5>ORDER SUMMARY</h5>\n\t\t\t                    <p className=\"no-margin evenly-align\">\n\t\t\t                        <span className=\"cart-total-quantity\">{cartData.total_quantity} items</span>\n\t\t\t                        <span className=\"cart-total-price\">\n\t\t\t                        \t<span>${cartData.total_amount}</span>\n\t\t\t                        </span>\n\t\t\t                    </p>\n                                {cartData.discounted_amount !== 0 &&\n                                    <div className=\"cart-subtotal evenly-align cart__total\">\n                                        <span className=\"cart-subtotal__title\">Discount</span>\n                                        <strong><span className=\"cart-subtotal__price\">-${cartData.discounted_amount}</span></strong>\n                                    </div>\n                                }\n\t\t\t                  \t<div className=\"cart-subtotal evenly-align cart__total\">\n\t\t\t                        <span className=\"cart-subtotal__title\">Subtotal</span>\n\t\t\t                        <strong><span className=\"cart-subtotal__price\">${parseFloat(cartData.total_amount)-parseFloat(cartData.discounted_amount)}</span></strong>\n\t\t\t                    </div>\n\t\t\t                    <div className=\"cart__total evenly-align\">\n\t\t\t                        <span className=\"cart__total-text\">Total:</span>  \n\t\t\t                        <strong className=\"cart__total-price\">\n\t\t\t                        \t<span>${parseFloat(cartData.total_amount)-parseFloat(cartData.discounted_amount)}</span>\n\t\t\t                        \t<span> USD</span>\n\t\t\t                        </strong>\n\t\t\t                    </div>\n\t\t\t                  \t<button className=\"button update_btn\" type=\"submit\" \n                                    onClick={(e) => {\n                                        overallUpdateHandler(e) \n                                        toast.success(\"Product updated successfully!\", {position: toast.POSITION.TOP_CENTER})\n                                    }}>Update Quantity</button>\n\t\t\t                    <Link to={cartData.total_item !== 0 ? ROUTES.CHECKOUT: ROUTES.COLLECTIONS} className=\"button checkout_btn button--hollow\">Checkout</Link>\n\t\t\t                  \t<div className=\"cart-promo\">\n\t\t\t                    \t<h5>ENTER A PROMO CODE</h5>\n                                    {error && <p className=\"error-message\">{error}</p>}\n\t\t\t                    \t<input \n                                        type=\"text\" \n                                        id=\"devPromo\"\n                                        value={discountEntered}\n                                        onChange={({target}) => setDiscountEntered(target.value)}\n                                    />\n                                    <Link to={ROUTES.CART} onClick={applyDiscountHandler}>Apply Coupon</Link>\n                                    {/* {isValid === false? \n                                        <Link to={ROUTES.CART} disabled={!isValid} className={`${!isValid}-sub`}>Apply Coupon</Link>\n                                        : \n                                        <Link to={ROUTES.CART} onClick={applyDiscountHandler}>Apply Coupon</Link>\n                                    } */}\n\t\t\t                  \t</div>\n\t\t\t                  \t<div className=\"text-center mt-20\">\n\t\t\t                  \t\t<Link to={ROUTES.COLLECTIONS} title=\"Continue shopping\">Continue shopping</Link>\n\t\t\t                  \t</div>\n\t\t\t                </div>\n\t\t\t              \n\t\t\t            </div>\n\t                </div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</section>\n    )\n}"]},"metadata":{},"sourceType":"module"}